<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.1"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>音视频学习 (七) 音频渲染 - DevYK 个人博客</title><meta description="前言在讲解音频渲染之前，需要对音频的基础知识有所了解，所以该篇分为基础概念和AudioTrack 以及 OpenSL ES Demo 实例讲解，这样有助于更好的理解 Android 中音频渲染。 音频的基础概念涉及的知识点比较多，该篇文章的上半部分会详细的介绍，后续文章基本上都会涉及音频的开发，有了基础对于后面的内容就更容易上手了。"><meta property="og:type" content="blog"><meta property="og:title" content="音视频学习 (七) 音频渲染"><meta property="og:url" content="http://yoursite.com/2020/06/04/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%AD%A6%E4%B9%A0-%E4%B8%83-%E9%9F%B3%E9%A2%91%E6%B8%B2%E6%9F%93/"><meta property="og:site_name" content="DevYK 个人博客"><meta property="og:description" content="前言在讲解音频渲染之前，需要对音频的基础知识有所了解，所以该篇分为基础概念和AudioTrack 以及 OpenSL ES Demo 实例讲解，这样有助于更好的理解 Android 中音频渲染。 音频的基础概念涉及的知识点比较多，该篇文章的上半部分会详细的介绍，后续文章基本上都会涉及音频的开发，有了基础对于后面的内容就更容易上手了。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://devyk.oss-cn-qingdao.aliyuncs.com/blog/20200209170913.jpeg"><meta property="og:image" content="https://devyk.oss-cn-qingdao.aliyuncs.com/blog/20200209133557.png"><meta property="og:image" content="https://devyk.oss-cn-qingdao.aliyuncs.com/blog/20200209165845.png"><meta property="article:published_time" content="2020-06-04T10:12:00.000Z"><meta property="article:modified_time" content="2020-06-04T15:55:07.706Z"><meta property="article:author" content="DevYK"><meta property="article:tag" content="音视频学习路线"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://devyk.oss-cn-qingdao.aliyuncs.com/blog/20200209170913.jpeg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://yoursite.com/2020/06/04/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%AD%A6%E4%B9%A0-%E4%B8%83-%E9%9F%B3%E9%A2%91%E6%B8%B2%E6%9F%93/"},"headline":"DevYK 个人博客","image":["https://devyk.oss-cn-qingdao.aliyuncs.com/blog/20200209133557.png","https://devyk.oss-cn-qingdao.aliyuncs.com/blog/20200209165845.png"],"datePublished":"2020-06-04T10:12:00.000Z","dateModified":"2020-06-04T15:55:07.706Z","author":{"@type":"Person","name":"DevYK"},"description":"前言在讲解音频渲染之前，需要对音频的基础知识有所了解，所以该篇分为基础概念和AudioTrack 以及 OpenSL ES Demo 实例讲解，这样有助于更好的理解 Android 中音频渲染。 音频的基础概念涉及的知识点比较多，该篇文章的上半部分会详细的介绍，后续文章基本上都会涉及音频的开发，有了基础对于后面的内容就更容易上手了。"}</script><link rel="canonical" href="http://yoursite.com/2020/06/04/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%AD%A6%E4%B9%A0-%E4%B8%83-%E9%9F%B3%E9%A2%91%E6%B8%B2%E6%9F%93/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="DevYK 个人博客" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">about</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-06-04T10:12:00.000Z" title="2020-06-04T10:12:00.000Z">2020-06-04</time><span class="level-item"> DevYK </span><span class="level-item"><a class="link-muted" href="/categories/%E4%B8%93%E9%A2%98/">专题</a><span> / </span><a class="link-muted" href="/categories/%E4%B8%93%E9%A2%98/%E9%9F%B3%E8%A7%86%E9%A2%91/">音视频</a></span><span class="level-item">33 分钟 读完 (大约 4946 个字)</span><span class="level-item" id="busuanzi_container_page_pv"><i class="far fa-eye"></i>&nbsp;&nbsp;<span id="busuanzi_value_page_pv">0</span>次访问</span></div></div><h1 class="title is-3 is-size-4-mobile">音视频学习 (七) 音频渲染</h1><div class="content"><p><img src="https://devyk.oss-cn-qingdao.aliyuncs.com/blog/20200209170913.jpeg" alt=""></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在讲解音频渲染之前，需要对音频的基础知识有所了解，所以该篇分为基础概念和AudioTrack 以及 OpenSL ES Demo 实例讲解，这样有助于更好的理解 Android 中音频渲染。</p>
<p>音频的基础概念涉及的知识点比较多，该篇文章的上半部分会详细的介绍，后续文章基本上都会涉及音频的开发，有了基础对于后面的内容就更容易上手了。</p>
<a id="more"></a>


<h2 id="音频的基础知识"><a href="#音频的基础知识" class="headerlink" title="音频的基础知识"></a>音频的基础知识</h2><h3 id="声音的物理性质"><a href="#声音的物理性质" class="headerlink" title="声音的物理性质"></a>声音的物理性质</h3><ul>
<li><p>声音是波</p>
<p>说到声音我相信只要听力正常的人都听见过声音，那么声音是如何产生的呢？记得初中物理课本上的描述 - 声音是由物体的振动而产生的。其实声音是一种压力波，当敲打某个物体或演奏某个乐器时，它们的振动都会引起空气有节奏的振动，使周围的空气产生疏密变化，形成疏密相间的纵波，由此就产生了声波，这种现象会一直延续到振动消失为止。</p>
</li>
<li><p>声波的三要素</p>
<p>声波的三要素是频率、振幅、和波形，频率代表音阶的高低，振幅代表响度，波形代表音色。</p>
</li>
<li><p>声音的传播介质</p>
<p>声音的传播介质很广，它可以通过空气、液体和固体进行传播；而且介质不同，传播的速度也不同，比如声音在空气中的传播速度为 340m/s , 在蒸馏水中的传播速度为 1497 m/s , 而在铁棒中的传播速度则可以高达 5200 m/s ；不过，声音在真空中时无法传播的。</p>
</li>
<li><p>回声</p>
<p>当我们在高山或者空旷地带高声大喊的时候，经常会听到回声，之所以会有回声是因为声音在传播过程中遇到障碍物会反弹回来，再次被我们听到。</p>
<p>但是，若两种声音传到我们的耳朵里的时差小于 80 毫秒，我们就无法区分开这两种声音了，其实在日常生活中，人耳也在收集回声，只不过由于嘈杂的外接环境以及回声的分贝比较低，所以我们的耳朵分辨不出这样的声音，或者说是大脑能接收到但分辨不出。</p>
</li>
<li><p>共鸣</p>
<p>自然界中有光能，水能，生活中有机械能，电能，其实声音也可以产生能量，例如两个频率相同的物体，敲打其中一个物体时另一个物体也会振动发生。这种现象称为共鸣，共鸣证明了声音传播可以带动另一个物体振动，也就是说，声音的传播过程也是一种能量的传播过程。</p>
</li>
</ul>
<h3 id="数字音频"><a href="#数字音频" class="headerlink" title="数字音频"></a>数字音频</h3><p>上一小节我们主要介绍了声音的物理现象以及声音中常见的概念，也会后续的讲解统一了术语，本节主要介绍数字音频概念。</p>
<p>为了将模拟信号数字化，本节将分为 3 个概念对数字音频进行讲解，分别是<strong>采样、量化和编码</strong>。首先要对模拟信号进行采样，所谓采样就是在时间轴上对信号进行数字化。根据奈奎斯特定理（也称采样定理），按比声音最高频率高 2 倍以上的频率对声音进行采样，对于高质量的音频信号，其频率范围在 20Hz ~ 20kHz ，所以采样频率一般为 44.1kHz ,这样就保证采样声音达到 20kHz 也能被数字化，从而使得经过数字化处理之后，人耳听到的声音质量不会被降低。而所谓的 44.1 kHz 就是代表 1 s 会采样 44100 次。</p>
<p>那么，具体的每个采样又该如何表示呢？这就涉及到将要讲解的第二个概念: 量化。量化是指在幅度轴上对信号进行数字化，比如用 16 bit 的二进制信号来表示声音的一个采样，而 16 bit 所表示的范围是 [-32768 , 32767] , 共有 65536 个可能取值，因此最终模拟的音频信号在幅度上也分为了 65536 层。</p>
<p>既然每一个分量都是一个采样，那么这么多的采样该如何进行存储呢？这就涉及将要讲解的第三个概念: 编码。所谓编码，就是按照一定的格式记录采样和量化后的数字数据，比如顺序存储或压缩存储等等。</p>
<p>这里涉及了很多中格式，通常所说的音频的裸数据就是 PCM (Pulse Code Modulation) 数据。描述一段 PCM 数据一般需要以下几个概念：量化格式(sampleFormat)、采样率（sampleRate）、声道数 (channel) 。以 CD 的音质为例：量化格式为 16 bit （2 byte）,采样率 44100 ，声道数为 2 ，这些信息就描述了 CD 的音质。而对于声音的格式，还有一个概念用来描述它的大小，称为数据比特率，即 1s 时间内的比特数目，它用于衡量音频数据单位时间内的容量大小。而对于 CD 音质的数据，比特率为多少呢？ 计算如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">44100 * 16 * 2 &#x3D; 1378.125 kbps</span><br></pre></td></tr></table></figure>

<p>那么在一分钟里，这类 CD 音质的数据需要占据多大的存储空间呢？计算如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1378.125 * 60 &#x2F; 8 &#x2F; 1024 &#x3D; 10.09 MB</span><br></pre></td></tr></table></figure>

<p>当然，如果 sampleFormat 更加精确 (比如用 4 个字节来描述一个采样)，或者 sampleRate 更加密集 (比如 48kHz 的采样率)， 那么所占的存储空间就会更大，同时能够描述的声音细节就会越精确。存储的这段二进制数据即表示将模拟信号转为数字信号了，以后就可以对这段二进制数据进行存储，播放，复制，或者进行其它操作。 </p>
<h3 id="音频编码"><a href="#音频编码" class="headerlink" title="音频编码"></a>音频编码</h3><p>上面提到了 CD 音质的数据采样格式，曾计算出每分钟需要的存储空间约为 10.09 MB ,如果仅仅是将其存储在光盘或者硬盘中，可能是可以接受的，但是若要在网络中实时在线传输的话，那么这个数据量可能就太大了，所以必须对其进行压缩编码。压缩编码的基本指标之一就是压缩比，压缩比通常小于 1 。压缩算法包括有损压缩和无损压缩。无所压缩是指解压后的数据可以完全复原。在常用的压缩格式中，用的较多的是有损压缩，有损压缩是指解压后的数据不能完全恢复，会丢失一部分信息，压缩比越小，丢失的信息就比越多，信号还原后的失真就会越大。根据不同的应用场景 (包括存储设备、传输网络环境、播放设备等)，可以选用不同的压缩编码算法，如 PCM 、WAV、AAC 、MP3 、Ogg 等。</p>
<ul>
<li><p>WAV 编码</p>
<p>WAV 编码就是在 PCM 数据格式的前面加了 44 个字节，分别用来存储 PCM 的采样率、声道数、数据格式等信息。</p>
<p><strong>特点:</strong> 音质好，大量软件支持。</p>
<p><strong>场景:</strong> 多媒体开发的中间文件、保存音乐和音效素材。</p>
</li>
<li><p>MP3 编码</p>
<p>MP3 具有不错的压缩比，使用 LAME 编码 （MP3 编码格式的一种实现）的中高码率的 MP3 文件，听感上非常接近源 WAV 文件，当然在不同的应用场景下，应该调整合适的参数以达到最好的效果。</p>
<p><strong>特点:</strong> 音质在 128 Kbit/s 以上表现还不错，压缩比比较高，大量软件和硬件都支持，兼容性好。</p>
<p><strong>场景:</strong> 高比特率下对兼容性有要求的音乐欣赏。</p>
</li>
<li><p>AAC 编码</p>
<p>AAC 是新一代的音频有损压缩技术，它通过一些附加的编码技术(比如 PS 、SBR) 等，衍生出了 LC-AAC 、HE-AAC 、HE-AAC v2 三种主要的编码格式。LC-AAC 是比较传统的 AAC ,相对而言，其主要应用于中高码率场景的编码 (&gt;=80Kbit/s) ; HE-AAC 相当于 AAC + SBR  主要应用于中低码率的编码 （&lt;= 80Kbit/s）; 而新推出的 HE-AAC v2 相当于 AAC + SBR + PS 主要用于低码率场景的编码 (&lt;= 48Kbit/s) 。事实上大部分编码器都设置为 &lt;= 48Kbit/s 自动启用 PS 技术，而 &gt; 48Kbit/s 则不加 PS ，相当于普通的 HE-AAC。</p>
<p><strong>特点:</strong> 在小于 128Kbit/s 的码率下表现优异，并且多用于视频中的音频编码。</p>
<p><strong>场景:</strong> 128 Kbit/s 以下的音频编码，多用于视频中音频轨的编码。</p>
</li>
<li><p>Ogg 编码</p>
<p>Ogg 是一种非常有潜力的编码，在各种码率下都有比较优秀的表现，尤其是在中低码率场景下。Ogg 除了音质好之外，还是完全免费的，这为 Ogg 获得更多的支持打好了基础，Ogg 有着非常出色的算法，可以用更小的码率达到更好的音质，128 Kbit/s 的 Ogg 比 192kbit/s 甚至更高码率的 MP3 还要出色。但是目前因为还没有媒体服务软件的支持，因此基于 Ogg 的数字广播还无法实现。Ogg 目前受支持的情况还不够好，无论是软件上的还是硬件上的支持，都无法和 MP3 相提并论。</p>
<p><strong>特点:</strong> 可以用比 MP3 更小的码率实现比 MP3 更好的音质，高中低码率下均有良好的表现，兼容性不够好，流媒体特性不支持。</p>
<p><strong>场景:</strong> 语言聊天的音频消息场景。</p>
</li>
</ul>
<h2 id="Android-平台下的音频渲染"><a href="#Android-平台下的音频渲染" class="headerlink" title="Android 平台下的音频渲染"></a>Android 平台下的音频渲染</h2><p>音频基础概念上面讲完了，下面我们实现 Android 下的音频渲染，为实现音视频播放器打下一个基础，音视频采集视频录制的时候在讲解。</p>
<p>[PCM 文件 - 链接:<a href="https://pan.baidu.com/s/1ISS7bHMrFAentLB6o4kiBA">https://pan.baidu.com/s/1ISS7bHMrFAentLB6o4kiBA</a>  密码:5z1n](链接:<a href="https://pan.baidu.com/s/1ISS7bHMrFAentLB6o4kiBA">https://pan.baidu.com/s/1ISS7bHMrFAentLB6o4kiBA</a>  密码:5z1n)</p>
<h3 id="AudioTrack-的使用"><a href="#AudioTrack-的使用" class="headerlink" title="AudioTrack 的使用"></a>AudioTrack 的使用</h3><p>由于 AudioTrack 是 Android  SDK 层提供的最底层的 音频播放 API,因此只允许输入裸数据 PCM 。和 MediaPlayer 相比，对于一个压缩的音频文件(比如 MP3 、AAC 等文件)，它只需要自行实现解码操作和缓冲区控制。因为这里只涉及 AudioTrack 的音频渲染端，编解码我们后面在讲解，所以本小节只介绍如何使用 AudioTrack 渲染音频 PCM 裸数据。</p>
<ol>
<li><p>配置 AudioTrack</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">AudioTrack</span><span class="params">(<span class="keyword">int</span> streamType, <span class="keyword">int</span> sampleRateInHz, <span class="keyword">int</span> channelConfig, <span class="keyword">int</span> audioFormat,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">int</span> bufferSizeInBytes, <span class="keyword">int</span> mode)</span></span></span><br></pre></td></tr></table></figure>

<p><strong>streamType</strong>：Android 手机提供了多重音频管理策略，当系统又多个进程需要播放音频的时候，管理策略会决定最终的呈现效果，该参数的可选值将以常量的形式定义在类 AudioManager 中，主要包括以下内容:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**电话铃声 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STREAM_VOICE_CALL = AudioSystem.STREAM_VOICE_CALL;</span><br><span class="line"><span class="comment">/** 系统铃声 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STREAM_SYSTEM = AudioSystem.STREAM_SYSTEM;</span><br><span class="line"><span class="comment">/** 铃声*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STREAM_RING = AudioSystem.STREAM_RING;</span><br><span class="line"><span class="comment">/** 音乐声 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STREAM_MUSIC = AudioSystem.STREAM_MUSIC;</span><br><span class="line"><span class="comment">/** 警告声 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STREAM_ALARM = AudioSystem.STREAM_ALARM;</span><br><span class="line"><span class="comment">/** 通知声 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STREAM_NOTIFICATION = AudioSystem.STREAM_NOTIFICATION;</span><br></pre></td></tr></table></figure>

<p><strong>sampleRateInHz</strong>：采样率，即播放的音频每秒钟会有没少次采样，可选用的采样频率列表为: 8000 , 16000 , 22050 , 24000 ,32000 , 44100 , 48000 等，大家可以根据自己的应用场景进行合理的选择。</p>
<p><strong>channelConfig:</strong> 声道数的配置，可选值以常量的形式配置在类 AudioFormat 中，常用的是 CHANNEL_IN_MONO (单声道)、CHANNEL_IN_STEREO (双声道) ，因为现在大多数手机的麦克风都是伪立体声采集，为了性能考虑，建议使用单声道进行采集。</p>
<p><strong>audioFormat:</strong> 该参数是用来配置 “数据位宽” 的，即采样格式，可选值以常量的形式定义在类 AudioFormat 中，分别为 ENCODING_PCM_16BIT (兼容所有手机)、ENCODING_PCM_8BIT ，</p>
<p><strong>bufferSizeInBytes:</strong> 配置内部的音频缓冲区的大小， AudioTrack 类提供了一个帮助开发者确定的 bufferSizeInBytes 的函数，其原型具体如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getMinBufferSize</span><span class="params">(<span class="keyword">int</span> sampleRateInHz, <span class="keyword">int</span> channelConfig, <span class="keyword">int</span> audioFormat)</span></span></span><br></pre></td></tr></table></figure>

<p>在实际开发中，强烈建议由该函数计算出需要传入的缓冲区大小，而不是手动计算。</p>
<p><strong>mode:</strong> AudioTrack 提供了两种播放模式，可选的值以常量的形式定义在类 AudioTrack 中，一个是 MODE_STATIC , 需要一次性将所有的数据都写入播放缓冲区中，简单高效，通常用于播放铃声、系统提醒的音频片段；另一个是 MODE_STREAM ，需要按照一定的时间间隔不断地写入音频数据，理论上它可以应用于任何音频播放的场景。</p>
</li>
<li><p>Play</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//当前播放实例是否初始化成功，如果处于初始化成功的状态并且未播放的状态，那么就调用 play</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">null</span> != mAudioTrack &amp;&amp; mAudioTrack.getState() != AudioTrack.STATE_UNINITIALIZED &amp;&amp; mAudioTrack.getPlayState() != PLAYSTATE_PLAYING)</span><br><span class="line">   mAudioTrack.play();</span><br></pre></td></tr></table></figure>
</li>
<li><p>销毁资源</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">release</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Log.d(TAG, <span class="string">"==release==="</span>);</span><br><span class="line">    mStatus = Status.STATUS_NO_READY;</span><br><span class="line">    <span class="keyword">if</span> (mAudioTrack != <span class="keyword">null</span>) &#123;</span><br><span class="line">        mAudioTrack.release();</span><br><span class="line">        mAudioTrack = <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>具体实例请移步 <a href="https://github.com/yangkun19921001/ndk_study/blob/master/audioplay/src/main/java/com/devyk/audioplay/AudioTracker.java[]">AudioPlay 项目的 AudioTracker 部分</a>，需要把项目中 raw 目录下的 pcm 文件放入 sdcard 跟目录中。</p>
</li>
</ol>
<h3 id="OpenSL-ES-的使用"><a href="#OpenSL-ES-的使用" class="headerlink" title="OpenSL ES 的使用"></a>OpenSL ES 的使用</h3><p><a href="https://developer.android.google.cn/ndk/guides/audio/opensl-for-android">OpenSL ES 官方文档</a></p>
<p>OpenSL ES 全称(Open Sound Library for Embedded System) ,即嵌入式音频加速标准。OpenSL ES 是无授权费、跨平台、针对嵌入式系统精心优化的硬件音频加速 API ，它能为嵌入式移动多媒体设备上的本地应用程序开发者提供了标准化、高性能、低响应时间的音频功能实现方法，同时还实现了软/硬音频性能的直接跨平台部署，不仅降低了执行难度，而且还促进了高级音频市场的发展。</p>
<p><img src="https://devyk.oss-cn-qingdao.aliyuncs.com/blog/20200209133557.png" alt=""></p>
<p>上图描述了 OpenSL ES 的架构，在 Android 中，High Level Audio Libs 是音频 Java 层 API 输入输出，属于高级 API , 相对来说，OpenSL ES 则是比价低层级的 API, 属于 C 语言 API 。在开发中，一般会直接使用高级 API , 除非遇到性能瓶颈，如语音实时聊天、3D Audio 、某些 Effects 等，开发者可以直接通过 C/C++ 开发基于 OpenSL ES 音频的应用。</p>
<p>在使用 OpenSL ES 的 API 之前，需要引入 OpenSL ES 的头文件，代码如下:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这是标准的OpenSL ES库</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;SLES/OpenSLES.h&gt;</span></span></span><br><span class="line"><span class="comment">// 这里是针对安卓的扩展，如果要垮平台则需要注意</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;SLES/OpenSLES_Android.h&gt;</span></span></span><br></pre></td></tr></table></figure>

<ol>
<li><p>创建引擎并获取引擎接口</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">createEngine</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 音频的播放，就涉及到了，OpenLSES</span></span><br><span class="line">        <span class="comment">// TODO 第一大步：创建引擎并获取引擎接口</span></span><br><span class="line">        <span class="comment">// 1.1创建引擎对象：SLObjectItf engineObject</span></span><br><span class="line">        SLresult result = slCreateEngine(&amp;engineObj, <span class="number">0</span>, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">        <span class="keyword">if</span> (SL_RESULT_SUCCESS != result) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.2 初始化引擎</span></span><br><span class="line">        result = (*engineObj) -&gt;Realize(engineObj, SL_BOOLEAN_FALSE);</span><br><span class="line">        <span class="keyword">if</span> (SL_BOOLEAN_FALSE != result) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.3 获取引擎接口 SLEngineItf engineInterface</span></span><br><span class="line">        result = (*engineObj) -&gt;GetInterface(engineObj, SL_IID_ENGINE, &amp;engine);</span><br><span class="line">        <span class="keyword">if</span> (SL_RESULT_SUCCESS != result) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="2">
<li><p>设置混音器</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TODO 第二大步 设置混音器</span></span><br><span class="line">        <span class="comment">// 2.1 创建混音器：SLObjectItf outputMixObject</span></span><br><span class="line">        result = (*engine)-&gt;CreateOutputMix(engine, &amp;outputMixObj, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (SL_RESULT_SUCCESS != result) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.2 初始化 混音器</span></span><br><span class="line">        result = (*outputMixObj)-&gt;Realize(outputMixObj, SL_BOOLEAN_FALSE);</span><br><span class="line">        <span class="keyword">if</span> (SL_BOOLEAN_FALSE != result) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建播放器</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TODO 第三大步 创建播放器</span></span><br><span class="line">    <span class="comment">// 3.1 配置输入声音信息</span></span><br><span class="line">    <span class="comment">// 创建buffer缓冲类型的队列 2个队列</span></span><br><span class="line">    SLDataLocator_AndroidSimpleBufferQueue locBufq = &#123;SL_DATALOCATOR_ANDROIDSIMPLEBUFFERQUEUE, <span class="number">2</span>&#125;;</span><br><span class="line">    <span class="comment">// pcm数据格式</span></span><br><span class="line">    <span class="comment">// SL_DATAFORMAT_PCM：数据格式为pcm格式</span></span><br><span class="line">    <span class="comment">// 2：双声道</span></span><br><span class="line">    <span class="comment">// SL_SAMPLINGRATE_44_1：采样率为44100（44.1赫兹 应用最广的，兼容性最好的）</span></span><br><span class="line">    <span class="comment">// SL_PCMSAMPLEFORMAT_FIXED_16：采样格式为16bit （16位）(2个字节)</span></span><br><span class="line">    <span class="comment">// SL_PCMSAMPLEFORMAT_FIXED_16：数据大小为16bit （16位）（2个字节）</span></span><br><span class="line">    <span class="comment">// SL_SPEAKER_FRONT_LEFT | SL_SPEAKER_FRONT_RIGHT：左右声道（双声道）  （双声道 立体声的效果）</span></span><br><span class="line">    <span class="comment">// SL_BYTEORDER_LITTLEENDIAN：小端模式</span></span><br><span class="line">    SLDataFormat_PCM formatPcm = &#123;SL_DATAFORMAT_PCM, (SLuint32) mChannels, mSampleRate,</span><br><span class="line">                                  (SLuint32) mSampleFormat, (SLuint32) mSampleFormat,</span><br><span class="line">                                  mChannels == <span class="number">2</span> ? <span class="number">0</span> : SL_SPEAKER_FRONT_CENTER,</span><br><span class="line">                                  SL_BYTEORDER_LITTLEENDIAN&#125;;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * Enable Fast Audio when possible:  once we set the same rate to be the native, fast audio path</span></span><br><span class="line"><span class="comment">     * will be triggered</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">if</span> (mSampleRate) &#123;</span><br><span class="line">        formatPcm.samplesPerSec = mSampleRate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 数据源 将上述配置信息放到这个数据源中</span></span><br><span class="line">    SLDataSource audioSrc = &#123;&amp;locBufq, &amp;formatPcm&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.2 配置音轨（输出）</span></span><br><span class="line">    <span class="comment">// 设置混音器</span></span><br><span class="line">    SLDataLocator_OutputMix locOutpuMix = &#123;SL_DATALOCATOR_OUTPUTMIX, mAudioEngine-&gt;outputMixObj&#125;;</span><br><span class="line">    SLDataSink audioSink = &#123;&amp;locOutpuMix, <span class="literal">nullptr</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * create audio player:</span></span><br><span class="line"><span class="comment">     *     fast audio does not support when SL_IID_EFFECTSEND is required, skip it</span></span><br><span class="line"><span class="comment">     *     for fast audio case</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//  需要的接口 操作队列的接口</span></span><br><span class="line">    <span class="keyword">const</span> SLInterfaceID ids[<span class="number">3</span>] = &#123;SL_IID_BUFFERQUEUE, SL_IID_VOLUME, SL_IID_EFFECTSEND&#125;;</span><br><span class="line">    <span class="keyword">const</span> SLboolean req[<span class="number">3</span>] = &#123;SL_BOOLEAN_TRUE, SL_BOOLEAN_TRUE, SL_BOOLEAN_TRUE&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//  3.3 创建播放器</span></span><br><span class="line">    result = (*mAudioEngine-&gt;engine)-&gt;CreateAudioPlayer(mAudioEngine-&gt;engine, &amp;mPlayerObj,</span><br><span class="line">                                                        &amp;audioSrc, &amp;audioSink,</span><br><span class="line">                                                        mSampleRate ? <span class="number">2</span> : <span class="number">3</span>, ids, req);</span><br><span class="line">    <span class="keyword">if</span> (result != SL_RESULT_SUCCESS) &#123;</span><br><span class="line">        LOGE(<span class="string">"CreateAudioPlayer failed: %d"</span>, result);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//  3.4 初始化播放器：mPlayerObj</span></span><br><span class="line">    result = (*mPlayerObj)-&gt;Realize(mPlayerObj, SL_BOOLEAN_FALSE);</span><br><span class="line">    <span class="keyword">if</span> (result != SL_RESULT_SUCCESS) &#123;</span><br><span class="line">        LOGE(<span class="string">"mPlayerObj Realize failed: %d"</span>, result);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//  3.5 获取播放器接口：SLPlayItf mPlayerObj</span></span><br><span class="line">    result = (*mPlayerObj)-&gt;GetInterface(mPlayerObj, SL_IID_PLAY, &amp;mPlayer);</span><br><span class="line">    <span class="keyword">if</span> (result != SL_RESULT_SUCCESS) &#123;</span><br><span class="line">        LOGE(<span class="string">"mPlayerObj GetInterface failed: %d"</span>, result);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置播放回调函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TODO 第四大步：设置播放回调函数</span></span><br><span class="line">    <span class="comment">// 4.1 获取播放器队列接口：SLAndroidSimpleBufferQueueItf mBufferQueue</span></span><br><span class="line">    result = (*mPlayerObj)-&gt;GetInterface(mPlayerObj, SL_IID_BUFFERQUEUE, &amp;mBufferQueue);</span><br><span class="line">    <span class="keyword">if</span> (result != SL_RESULT_SUCCESS) &#123;</span><br><span class="line">        LOGE(<span class="string">"mPlayerObj GetInterface failed: %d"</span>, result);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// 4.2 设置回调 void playerCallback(SLAndroidSimpleBufferQueueItf bq, void *context)</span></span><br><span class="line">    result = (*mBufferQueue)-&gt;RegisterCallback(mBufferQueue, playerCallback, <span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">if</span> (result != SL_RESULT_SUCCESS) &#123;</span><br><span class="line">        LOGE(<span class="string">"mPlayerObj RegisterCallback failed: %d"</span>, result);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    mEffectSend = <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="keyword">if</span> (mSampleRate == <span class="number">0</span>) &#123;</span><br><span class="line">        result = (*mPlayerObj)-&gt;GetInterface(mPlayerObj, SL_IID_EFFECTSEND, &amp;mEffectSend);</span><br><span class="line">        <span class="keyword">if</span> (result != SL_RESULT_SUCCESS) &#123;</span><br><span class="line">            LOGE(<span class="string">"mPlayerObj GetInterface failed: %d"</span>, result);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    result = (*mPlayerObj)-&gt;GetInterface(mPlayerObj, SL_IID_VOLUME, &amp;mVolume);</span><br><span class="line">    <span class="keyword">if</span> (result != SL_RESULT_SUCCESS) &#123;</span><br><span class="line">        LOGE(<span class="string">"mPlayerObj GetInterface failed: %d"</span>, result);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置播放器状态</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TODO 第五大步：设置播放器状态为播放状态</span></span><br><span class="line">result = (*mPlayer)-&gt;SetPlayState(mPlayer, SL_PLAYSTATE_PLAYING);</span><br><span class="line"><span class="keyword">if</span> (result != SL_RESULT_SUCCESS) &#123;</span><br><span class="line">    LOGE(<span class="string">"mPlayerObj SetPlayState failed: %d"</span>, result);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="6">
<li><p>手动激活回调函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OpenSLAudioPlay::enqueueSample</span><span class="params">(<span class="keyword">void</span> *data, <span class="keyword">size_t</span> length)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 必须等待一帧音频播放完毕后才可以 Enqueue 第二帧音频</span></span><br><span class="line">    pthread_mutex_lock(&amp;mMutex);</span><br><span class="line">    <span class="keyword">if</span> (mBufSize &lt; length) &#123;</span><br><span class="line">        mBufSize = length;</span><br><span class="line">        <span class="keyword">if</span> (mBuffers[<span class="number">0</span>]) &#123;</span><br><span class="line">            <span class="keyword">delete</span>[] mBuffers[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (mBuffers[<span class="number">1</span>]) &#123;</span><br><span class="line">            <span class="keyword">delete</span>[] mBuffers[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        mBuffers[<span class="number">0</span>] = <span class="keyword">new</span> <span class="keyword">uint8_t</span>[mBufSize];</span><br><span class="line">        mBuffers[<span class="number">1</span>] = <span class="keyword">new</span> <span class="keyword">uint8_t</span>[mBufSize];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">memcpy</span>(mBuffers[mIndex], data, length);</span><br><span class="line">    <span class="comment">// TODO 第六步：手动激活回调函数</span></span><br><span class="line">    (*mBufferQueue)-&gt;Enqueue(mBufferQueue, mBuffers[mIndex], length);</span><br><span class="line">    mIndex = <span class="number">1</span> - mIndex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>释放资源</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span></span><br><span class="line">JNIEXPORT <span class="keyword">void</span> JNICALL</span><br><span class="line">Java_com_devyk_audioplay_AudioPlayActivity_nativeStopPcm(JNIEnv *env, jclass type) &#123;</span><br><span class="line">    isPlaying = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (slAudioPlayer) &#123;</span><br><span class="line">        slAudioPlayer-&gt;<span class="built_in">release</span>();</span><br><span class="line">        <span class="keyword">delete</span> slAudioPlayer;</span><br><span class="line">        slAudioPlayer = <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (pcmFile) &#123;</span><br><span class="line">        fclose(pcmFile);</span><br><span class="line">        pcmFile = <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>完整的代码请参考仓库中 <a href="https://github.com/yangkun19921001/ndk_study/blob/master/audioplay/src/main/cpp/audio_play.cpp">OpenSL ES</a>部分。注意：需要把 raw 中的 pcm 文件放入 sdcard 根目录下。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>该篇文章主要介绍了音频的一些基础知识和使用 AudioTrack 以及 OpenSL ES 来渲染裸流音频数据。大家可以根据我的源代码中在加深理解。</p>
<p>最后的页面效果:</p>
<p><img src="https://devyk.oss-cn-qingdao.aliyuncs.com/blog/20200209165845.png" alt=""></p>
<h2 id="感谢"><a href="#感谢" class="headerlink" title="感谢"></a>感谢</h2><ul>
<li><a href="https://github.com/zhanxiaokai">音视频开发进阶指南-展晓凯</a></li>
<li><a href="https://www.jianshu.com/p/5513a181580f">https://www.jianshu.com/p/5513a181580f</a></li>
</ul>
</div><div class="article-tags size-small mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF/">音视频学习路线</a></div><!--!--></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button is-info donate"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="https://devyk.oss-cn-qingdao.aliyuncs.com/blog/20200604150710.jpeg" alt="支付宝"></span></a><a class="button donate" href="/" style="background-color:rgba(255,128,62,.87);border-color:transparent;color:white;" target="_blank" rel="noopener"><span class="icon is-small"><i class="fas fa-coffee"></i></span><span>送我杯咖啡</span></a><a class="button is-danger donate" href="/" target="_blank" rel="noopener"><span class="icon is-small"><i class="fab fa-patreon"></i></span><span>Patreon</span></a><a class="button is-success donate"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="https://devyk.oss-cn-qingdao.aliyuncs.com/blog/20200604150835.png" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2020/06/04/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%AD%A6%E4%B9%A0-%E5%85%AB-%E8%A7%86%E9%A2%91%E6%B8%B2%E6%9F%93/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">音视频学习 (八) 视频渲染</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2020/06/04/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%AD%A6%E4%B9%A0-%E5%85%AD-FFmpeg-%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91/"><span class="level-item">音视频学习 (六) FFmpeg 交叉编译</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div class="content" id="valine-thread"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js"></script><script>new Valine({
            el: '#valine-thread' ,
            appId: "j16d0HiTJvVWRQzjQN625f4W-gzGzoHsz",
            appKey: "7cgla0UfvddS9PjRz7Lcvqn7",
            placeholder: "请遵守中华人民共和国法律法规。填写邮箱信息以接收回复。",
            avatar: "mm",
            
            meta: ["nick","mail","link"],
            pageSize: 10,
            lang: "zh-CN",
            
            highlight: true,
            
            
            
            
            
            requiredFields: [],
        });</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://devyk.oss-cn-qingdao.aliyuncs.com/blog/20200427113132.jpeg" alt="DevYK"></figure><p class="title is-size-4 is-block line-height-inherit">DevYK</p><p class="is-size-6 is-block">Android/NDK/音视频/跨平台</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>BeiJing</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">13</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">5</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">2</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/yangkun19921001" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/yangkun19921001"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="QQ" href="http://wpa.qq.com/msgrd?v=1&amp;uin=919079498&amp;site=ioshenmue&amp;menu=yes"><i class="fab fa-qq"></i></a></div></div></div><!--!--><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile is-mobile" href="https://github.com/yangkun19921001/Blog/blob/master/about.md" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">联系我</span></span><span class="level-right"><span class="level-item tag">github.com</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://juejin.im/user/578259398ac2470061f3a3fb/posts" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">掘金</span></span><span class="level-right"><span class="level-item tag">juejin.im</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/%E4%B8%93%E9%A2%98/"><span class="level-start"><span class="level-item">专题</span></span><span class="level-end"><span class="level-item tag">11</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/%E4%B8%93%E9%A2%98/%E9%9F%B3%E8%A7%86%E9%A2%91/"><span class="level-start"><span class="level-item">音视频</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/%E6%9C%8D%E5%8A%A1/"><span class="level-start"><span class="level-item">服务</span></span><span class="level-end"><span class="level-item tag">2</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/%E6%9C%8D%E5%8A%A1/apprtc/"><span class="level-start"><span class="level-item">apprtc</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E6%9C%8D%E5%8A%A1/nginx/"><span class="level-start"><span class="level-item">nginx</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2020/06/"><span class="level-start"><span class="level-item">六月 2020</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/webrtc/"><span class="tag">webrtc</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF/"><span class="tag">音视频学习路线</span><span class="tag is-grey-lightest">12</span></a></div></div></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2020-06-04T11:23:00.000Z">2020-06-04</time></p><p class="title is-6"><a class="link-muted" href="/2020/06/04/webrtc-%E5%AD%A6%E4%B9%A0-%E4%B8%80-%E6%90%AD%E5%BB%BA-AppRTC-%E6%9C%8D%E5%8A%A1/">webrtc 学习 (一) 搭建 AppRTC 服务</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/%E6%9C%8D%E5%8A%A1/">服务</a> / <a class="link-muted" href="/categories/%E6%9C%8D%E5%8A%A1/apprtc/">apprtc</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-06-04T10:26:00.000Z">2020-06-04</time></p><p class="title is-6"><a class="link-muted" href="/2020/06/04/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%AD%A6%E4%B9%A0-%E5%8D%81%E4%BA%8C-FFmpeg-OpenSL-ES-%E5%AE%9E%E7%8E%B0%E9%9F%B3%E9%A2%91%E6%92%AD%E6%94%BE%E5%99%A8/">音视频学习 (十二) FFmpeg + OpenSL ES 实现音频播放器</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/%E4%B8%93%E9%A2%98/">专题</a> / <a class="link-muted" href="/categories/%E4%B8%93%E9%A2%98/%E9%9F%B3%E8%A7%86%E9%A2%91/">音视频</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-06-04T10:24:00.000Z">2020-06-04</time></p><p class="title is-6"><a class="link-muted" href="/2020/06/04/Android-%E5%8D%81%E4%B8%80-Android-%E7%AB%AF-rtmp-%E6%8E%A8%E6%B5%81/">音视频学习 (十一) Android 端 rtmp 推流</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/%E4%B8%93%E9%A2%98/">专题</a> / <a class="link-muted" href="/categories/%E4%B8%93%E9%A2%98/%E9%9F%B3%E8%A7%86%E9%A2%91/">音视频</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-06-04T10:22:00.000Z">2020-06-04</time></p><p class="title is-6"><a class="link-muted" href="/2020/06/04/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%AD%A6%E4%B9%A0-%E5%8D%81-%E5%9F%BA%E4%BA%8E-Nginx-%E6%90%AD%E5%BB%BA%E7%9B%B4%E6%92%AD%E6%9C%8D%E5%8A%A1%E5%99%A8/">音视频学习 (十) 基于 Nginx 搭建直播服务器</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/%E6%9C%8D%E5%8A%A1/">服务</a> / <a class="link-muted" href="/categories/%E6%9C%8D%E5%8A%A1/nginx/">nginx</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-06-04T10:21:00.000Z">2020-06-04</time></p><p class="title is-6"><a class="link-muted" href="/2020/06/04/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%AD%A6%E4%B9%A0-%E4%B9%9D-FFmpeg-librtmp-%E5%AE%9E%E7%8E%B0%E6%8B%89%E6%B5%81%E6%92%AD%E6%94%BE%E5%99%A8/">音视频学习 (九) FFmpeg + librtmp 实现拉流播放器</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/%E4%B8%93%E9%A2%98/">专题</a> / <a class="link-muted" href="/categories/%E4%B8%93%E9%A2%98/%E9%9F%B3%E8%A7%86%E9%A2%91/">音视频</a></p></div></article></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="DevYK 个人博客" height="28"></a><p class="size-small"><span>&copy; 2020 DevYK</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'http://yoursite.com',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>